name: Fox Recovery Builder

on:
  workflow_dispatch:
    inputs:
      crypto:
        description: "Whether to disable the encryption modules, true or false"
        required: false
        default: "false"
      Enable_cache:
        description: "Whether to enable cacheï¼Œtrue or false"
        required: true
        default: "true"
 
env:
  Rec_name: Ofox
  BASE_VER: 9
  FOX_BRANCH: "fox_9.0"
  Rec_url: https://gitlab.com/OrangeFox/sync.git -b master
  device: x554
  # DT_url: https://github.com/skyhuppa/Realme_8_RMX3085 -b fox_11.0
  DT_url: hhttps://github.com/skyhuppa/x554-twrp -b twrp-9.0
  # DT_path: device/realme/RMX3085
  DT_path: device/infinix/x554
  ProductFileHeader: twrp
  target: recoveryimage
  WorkSpace: workspace
  TZ: Africa/Accra
  Author: ${{github.actor}}
  Delete_old: false
  
jobs:
  build:
    runs-on: ubuntu-22.04

    steps:
      - name: "Cleanup Environment"
        uses: rokibhasansagar/slimhub_actions@main

      - name: Prepare the environment
        run: |
           sudo apt update
           sudo apt -y upgrade
           sudo apt -y install gperf gcc-multilib gcc-10-multilib g++-multilib g++-10-multilib build-essential libstdc++6 clang zlib1g-dev libpng-dev rsync libssl-dev bison flex aria2 make automake zip wget curl git libc6-dev lib32ncurses5-dev libncurses5-dev libncursesw5-dev libncurses5 libwxgtk3.0-gtk3-dev x11proto-core-dev libx11-dev tree lib32z-dev libgl1-mesa-dev libxml2-utils xsltproc bc ccache lib32readline-dev lib32z1-dev liblz4-tool libncurses5-dev libsdl1.2-dev libxml2 lzop pngcrush schedtool squashfs-tools imagemagick libbz2-dev lzma ncftp qemu-user-static libstdc++-10-dev libc6 libc-bin libcurl4-openssl-dev
          # sudo apt install android-sdk
          
      - name: Set Swap Space
        uses: pierotofy/set-swap-space@master
        with:
           swap-size-gb: 12
  
      - uses: actions/checkout@v3
      - name: Setup dotnet
        uses: actions/setup-dotnet@v3
        with:
           dotnet-version: | 
                6.0.x
    
      - name: Install OpenJDK
        uses: actions/setup-java@v3
        with:
           distribution: 'zulu'
           java-version: '8'

      - name: Setup SSH Keys
        if: ${{ startsWith(github.event.inputs.MANIFEST_URL, 'git@github.com') }}
        uses: webfactory/ssh-agent@v0.5.4
        with:
          ssh-private-key: |
              ${{ secrets.SSH_PRIVATE_KEY }}
              
   #   - name: Set variables
   #     run: |
   #      echo "::set-output name=date::$(date +%F)"
   #     id: var
      
      - name: Sync recovery source
        run: |
             mkdir ${{env.WorkSpace}}
             cd ${{env.WorkSpace}}
             git clone https://gitlab.com/OrangeFox/sync.git -b master
             cd sync
             bash orangefox_sync.sh --branch 9.0 --path ~/fox_9.0
             
 #     - name: Repo Sync
 #       run: |
 #            repo sync -j$(nproc --all) --force-sync
 #            working-directory: ${{env.WorkSpace}}  
             
 #     - name: Build Recovery
 #       run: |
           
   
             

          

